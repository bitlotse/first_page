{% extends "layouts/default.njk" %}

{% block css %}
  {{ super() }} {# This will output the CSS links from default.njk #}
  <link rel="stylesheet" href="/css/underpages.css">
{% endblock %}

{% block content %}
  <section class="service-detail">
    <div class="container">
      <div class="service-detail-layout">
        <div class="icon-column">
          {# Check if 'cardImage' is available in front matter (e.g., 'card1.jpg') #}
          {# The image should be in your images directory, e.g., /src/img/card1.jpg #}
          {% if cardImage %}
            {# Construct the path for the eleventy-img shortcode #}
            {% set imageSrcPath = "img/" + cardImage %}
            {# Define alt text for accessibility #}
            {% set altText = cardImageAlt | default(title + ' illustration') %}

            {# Use the eleventy-img shortcode for optimized, responsive images #}
            {% image imageSrcPath, altText, {
                class: "service-detail-card-image",
                sizes: "(min-width: 768px) 30vw, 100vw",
                widths: [300, 500, 700],
                formats: ["webp", "jpeg"],
                loading: "lazy"
            } %}
          {% else %}
            {# Fallback if cardImage is not defined in front matter #}
            <div class="image-placeholder"><span>Bild nicht verfügbar</span></div>
          {% endif %}
        </div>

        {# Vertical Rule between Icon and Content #}
        <div class="service-detail-vertical-rule"></div>

        <div class="content-column">
          <h1>{{ title }}</h1>
          <div class="service-description">
            {{ content | safe }}
            <div class="service-actions-footer">
              {# CTA Button to Contact Page #}
              <a href="/contact/" class="btn">Jetzt Termin vereinbaren</a>

              <a href="{{ '/services/' | url }}" class="return-arrow-link" aria-label="Zurück zur Dienstleistungsübersicht">
                <img src="/img/icons/arrow-left.svg" alt="Pfeil zurück zur Übersicht">
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  {# Structured Data for Schema.org #}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "WebSite",
        "@id": "{{ site.url }}/#website",
        "url": "{{ site.url }}/",
        "name": "{{ site.name }}",
        "description": "{{ site.default_description }}", {# Corrected path #}
        "publisher": { "@id": "{{ site.url }}/#localbusiness" }
      },
      {
        "@type": "WebPage",
        "@id": "{{ site.url }}{{ page.url | url }}#webpage",
        "name": "{{ title }} - {{ site.name }}",
        "description": "{{ description | escape }}",
        "url": "{{ site.url }}{{ page.url | url }}",
        "image": {
          "@type": "ImageObject",
          "url": "{% if cardImage %}{{ site.url }}/img/{{ cardImage | split('.') | first }}-700w.jpeg{% else %}{{ site.url }}{{ site.default_og_image_path | url }}{% endif %}"
        },
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "{{ site.url }}{{ page.url | url }}"
        }
      },
      {
        "@type": ["BeautySalon", "LocalBusiness", "Organization"],
        "@id": "{{ site.url }}/#localbusiness",
        "name": "{{ site.name }}",
        "image": "{{ site.url }}{{ site.default_og_image_path | url }}",
        "url": "{{ site.url }}",
        "logo": {
          "@type": "ImageObject",
          "url": "{{ site.url }}{{ site.logo_path | url }}" {# Used logo_path #}
        },
        "telephone": "{{ site.contact.phoneLink }}", {# Used phoneLink for full number #}
        "email": "{{ site.contact.email }}",
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "{{ site.contact.address.street }}", {# Corrected path #}
          "addressLocality": "{{ site.contact.address.city }}", {# Corrected path #}
          "postalCode": "{{ site.contact.address.zip }}", {# Corrected path #}
          "addressCountry": "{{ site.contact.address.country }}" {# Corrected path #}
        },
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": "{{ site.contact.address.geo.latitude }}", {# Corrected path #}
          "longitude": "{{ site.contact.address.geo.longitude }}" {# Corrected path #}
        },
        "openingHoursSpecification": [
          {% for spec in site.contact.openingHoursSchema %} {# Iterate directly over pre-formatted schema #}
          {
            "@type": "OpeningHoursSpecification",
            "dayOfWeek": [
              {% for day in spec.dayOfWeek %}
              "http://schema.org/{{ day }}"{% if not loop.last %},{% endif %} {# Add schema.org prefix #}
              {% endfor %}
            ],
            "opens": "{{ spec.opens }}",
            "closes": "{{ spec.closes }}"
          }{% if not loop.last %},{% endif %}
          {% endfor %}
        ],
        "priceRange": "{{ site.priceRange }}",
        "hasMap": "{{ site.googleBusinessProfileURL }}", {# Used direct URL #}
        "publicAccess": true,
        "areaServed": {
          "@type": "Place",
          "name": "{{ site.contact.address.city }}" {# Used city from contact address #}
        },
        "sameAs": [
          "{{ site.googleBusinessProfileURL }}", {# Included GMB profile URL #}
          {% for social in site.social %}
          "{{ social.url }}"{% if not loop.last %},{% endif %}
          {% endfor %}
        ]
      },
      {# START OF SERVICE SCHEMA - ADDED TO @GRAPH #}
      {
        "@type": "Service",
        "name": "{{ title | escape }}",
        "description": "{{ description | escape }}",
        "url": "{{ site.url }}{{ page.url | url }}",
        {% if cardImage %}
        "image": "{{ site.url }}/img/{{ cardImage | split('.') | first }}-700w.jpeg",
        {% elif site.default_og_image_path %}
        "image": "{{ site.url }}{{ site.default_og_image_path | url }}",
        {% endif %}
        "provider": {
          "@type": "{{ site.contact.schemaType | default('Organization') }}", {# Using site.contact.schemaType, default to Organization #}
          "name": "{{ site.name | escape }}",
          "url": "{{ site.url }}",
          "@id": "{{ site.url }}/#localbusiness" {# Link to the LocalBusiness entity in the graph #}
        }
        {% if serviceName %}
        , "serviceOutput": {
            "@type": "Thing",
            "name": "{{ serviceName | escape }}"
          }
        {% endif %}
        {% if serviceType %}
        , "serviceType": "{{ serviceType | escape }}"
        {% endif %}
        {% if areaServed %}
        , "areaServed": {
            "@type": "{{ areaServed.type | default('Place') }}",
            "name": "{{ areaServed.name | escape }}"
            {% if areaServed.address %}
            ,"address": {
              "@type": "PostalAddress",
              "streetAddress": "{{ areaServed.address.streetAddress | escape }}",
              "addressLocality": "{{ areaServed.address.addressLocality | escape }}",
              "postalCode": "{{ areaServed.address.postalCode | escape }}",
              "addressCountry": "{{ areaServed.address.addressCountry | escape }}"
            }
            {% endif %}
          }
        {% endif %}
        {% if price %}
        , "offers": {
            "@type": "Offer",
            "price": "{{ price }}",
            "priceCurrency": "{{ priceCurrency | default('EUR') }}",
            "url": "{{ site.url }}{{ page.url | url }}",
            "availability": "https://schema.org/InStoreOnly"
          }
        {% endif %}
      }
      {# END OF SERVICE SCHEMA #}
    ]
  }
  </script>
{% endblock %}